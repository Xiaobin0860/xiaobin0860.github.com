---
layout: post
title: "bugs-2017"
date: 2017-01-01
categories: bug
---

---

## 日期:

2017.11.12

## 问题:

游戏部分服(尤其 100 服以后)跨服相关功能出错

## 原因:

Center 根据 uuid({sid}:{uuid})找 Gate 连接时, 使用了 strstr 在 uuid 里查找 sid, 这样 G100 会匹配 到 G10, 导致数据发到错误的服务器上.

## 怎么发现的:

服务器开取 100 服以后, 有玩家反应跨服相关功能失效.

## 修复:

增加 search_id({sid}:)作为查找 id, 并改为使用 memcpy 比较字符串前几位即可.

## 教训:

1. 尽量配置相关环境复现问题
2. 不要相当然的认为简单的方法就没有问题
3. 搜索和正则匹配容易出现未考虑到的异外情况, 最好能用完全匹配代替

---

![宝]({{ site.url }}/imgs/20171215.jpg)
